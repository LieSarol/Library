<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avatar Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#3b82f6',
              darkbg: '#0f172a',
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-darkbg text-white min-h-screen flex items-center justify-center p-6 relative">
    
    <!-- Back Button -->
    <a href="/" class="absolute top-6 left-6 text-primary hover:text-blue-400 transition">
      <i class="fas fa-arrow-left text-2xl"></i>
    </a>

    <div class="bg-slate-800 p-6 rounded-2xl shadow-xl max-w-md w-full text-center">
      <h1 class="text-2xl font-bold mb-4 text-primary">Avatar Generator</h1>

      <!-- Avatar Display -->
      <img id="avatarImg" src="" alt="Avatar" class="w-32 h-32 mx-auto rounded-full border-4 border-primary mb-4" />

      <!-- Seed Input -->
      <input
        id="seedInput"
        type="text"
        placeholder="Enter custom seed..."
        class="w-full mb-3 px-4 py-2 rounded-lg text-black focus:outline-none focus:ring-2 ring-primary"
      />

      <!-- Buttons -->
      <div class="flex flex-col gap-2">
        <button
          id="generateBtn"
          class="flex items-center justify-center gap-2 bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition"
        >
          <i class="fas fa-dice"></i>
          Generate Random
        </button>

        <button
          id="saveBtn"
          class="flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg transition"
        >
          <i class="fas fa-save"></i>
          Save Avatar
        </button>
      </div>

      <p id="status" class="mt-4 text-sm"></p>
    </div>

    <script>
      const avatarImg = document.getElementById("avatarImg");
      const status = document.getElementById("status");
      const seedInput = document.getElementById("seedInput");

      let currentSeed = "";

      const generateSeed = () => Math.random().toString(36).substring(2, 10);

      const updateAvatar = (seed) => {
        const url = `https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${encodeURIComponent(seed)}`;
        avatarImg.src = url;
        seedInput.value = seed;
      };

      document.getElementById("generateBtn").addEventListener("click", () => {
        currentSeed = generateSeed();
        updateAvatar(currentSeed);
        status.textContent = "Random avatar generated 🎲";
      });

      seedInput.addEventListener("input", (e) => {
        currentSeed = e.target.value.trim();
        if (currentSeed !== "") {
          updateAvatar(currentSeed);
          status.textContent = "Custom avatar updated ✍️";
        }
      });

      document.getElementById("saveBtn").addEventListener("click", async () => {
        if (!currentSeed || currentSeed.trim() === "") {
          status.textContent = "Please enter or generate a seed first!";
          return;
        }

        try {
          const res = await fetch("https://sky.leapcell.app/me/update", {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({
              avatar: `https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${encodeURIComponent(currentSeed)}`
            }),
          });

          const data = await res.json();

          if (res.ok) {
            status.textContent = "Avatar saved successfully! 💾";
          } else {
            status.textContent = `Error: ${data.error || data.errors?.join(", ")}`;
          }
        } catch (err) {
          console.error(err);
          status.textContent = "Failed to save avatar. 😢";
        }
      });

      // Init with random seed on load
      currentSeed = generateSeed();
      updateAvatar(currentSeed);
    </script>
  </body>
</html>
