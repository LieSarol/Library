<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Service Worker Notifications</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    pre {
      background: #111; color: #0f0; padding: 15px;
      border-radius: 8px; max-height: 300px; overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>🛠️ SW Notification Logs</h2>
  <p>Now using Service Worker 💪</p>
  <pre id="log">[Logs will appear here]</pre>

  <script>
    const logEl = document.getElementById("log");
    function log(msg) {
      console.log(msg);
      logEl.textContent += msg + "\n";
      logEl.scrollTop = logEl.scrollHeight;
    }

    document.addEventListener("DOMContentLoaded", async () => {
      log("🌐 DOM loaded");

      if (!("serviceWorker" in navigator)) {
        log("❌ Service Workers not supported.");
        return;
      }

      try {
        const registration = await navigator.serviceWorker.register('sw.js');
        log("🛡️ Service Worker registered.");

        if (Notification.permission === 'granted') {
          log("🔓 Notification permission already granted.");
          registration.showNotification("👋 Hello from SW!", {
            body: "You just loaded the page!",
            icon: "https://emojiapi.dev/api/v1/bell/64.png"
          });
          log("📢 Notification sent from SW.");
        } else if (Notification.permission !== 'denied') {
          const permission = await Notification.requestPermission();
          log("📜 Permission response: " + permission);

          if (permission === 'granted') {
            registration.showNotification("✅ Thanks!", {
              body: "Notifications are now enabled.",
              icon: "https://emojiapi.dev/api/v1/check-mark/64.png"
            });
            log("📢 Notification sent after permission.");
          } else {
            log("🚫 Permission denied.");
          }
        } else {
          log("🚫 Notification previously denied.");
        }

      } catch (err) {
        log("💥 SW Error: " + err.message);
      }
    });
  </script>
</body>
</html>
