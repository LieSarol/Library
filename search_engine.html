<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nexix Search ‚ú®</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-white min-h-screen flex flex-col font-sans">

  <!-- Header -->
  <header class="bg-gray-900 border-b border-gray-700 p-4 flex items-center justify-between">
  <!-- Menu icon on the left -->
  <div class="relative">
    <button id="menuBtn" class="text-white text-2xl focus:outline-none">
      <i class="fas fa-bars"></i>
    </button>
    <!-- Dropdown -->
    <div id="dropdownMenu" class="hidden absolute left-0 mt-2 w-40 bg-gray-800 border border-gray-700 rounded shadow-lg z-50">
      <a href="#" class="block px-4 py-2 hover:bg-gray-700 transition">Home</a>
      <a href="#" class="block px-4 py-2 hover:bg-gray-700 transition">Settings</a>
      <a href="#" class="block px-4 py-2 hover:bg-gray-700 transition">About</a>
    </div>
  </div>

  <!-- Title centered on small screens -->
  <h1 class="text-3xl font-bold text-center flex-1">‚ú® Nexix Search ‚ú®</h1>
</header>

  <!-- Search bar -->
  <div class="flex flex-col items-center p-4 gap-4">
    <input id="searchInput" type="text" placeholder="Type something cute..." 
      class="w-full max-w-lg px-4 py-3 rounded-xl bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 transition"/>
    
    <!-- Tabs -->
    <div class="flex gap-3">
      <button id="webTab" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 transition active">üîç Web</button>
      <button id="imgTab" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition">üñº Images</button>
    </div>
  </div>

  <!-- Results -->
  <main id="results" class="flex-1 p-4 flex flex-col gap-4 max-w-4xl mx-auto w-full"></main>

  <script>
    // Menu toggle
    const menuBtn = document.getElementById('menuBtn');
    const dropdownMenu = document.getElementById('dropdownMenu');
    menuBtn.addEventListener('click', () => {
      dropdownMenu.classList.toggle('hidden');
    });

    // Tabs + search
    const searchInput = document.getElementById("searchInput");
    const resultsDiv = document.getElementById("results");
    const webTab = document.getElementById("webTab");
    const imgTab = document.getElementById("imgTab");
    let mode = "web";

    webTab.onclick = () => {
      mode = "web";
      webTab.classList.add("bg-blue-600");
      imgTab.classList.remove("bg-blue-600");
      webTab.classList.remove("bg-gray-700");
      imgTab.classList.add("bg-gray-700");
      doSearch();
    };

    imgTab.onclick = () => {
      mode = "img";
      imgTab.classList.add("bg-blue-600");
      webTab.classList.remove("bg-blue-600");
      imgTab.classList.remove("bg-gray-700");
      webTab.classList.add("bg-gray-700");
      doSearch();
    };

    searchInput.addEventListener("keypress", e => {
      if (e.key === "Enter") doSearch();
    });

    async function doSearch() {
      const q = encodeURIComponent(searchInput.value.trim());
      if (!q) return;

      resultsDiv.innerHTML = "<p class='text-center text-gray-400'>‚ú® Loading cuteness... ‚ú®</p>";

      if (mode === "web") {
        const res = await fetch(`https://crawler30.onrender.com/crawl?query=${q}`);
        const data = await res.json();

        resultsDiv.innerHTML = "";
        data.forEach(site => {
          const domain = new URL(site.url).hostname.replace('www.', '');
          const item = document.createElement("div");
          item.className = "bg-gray-800 p-4 rounded-xl border border-gray-700 hover:scale-[1.02] transition transform flex flex-col gap-2";
          item.innerHTML = `
            <h3 class="flex items-center gap-2 text-lg flex-wrap">
              <img src="${site.brandIcon}" alt="icon" class="w-5 h-5 rounded-sm" 
                   onerror="this.onerror=null; this.src='https://www.google.com/s2/favicons?domain=${domain}&sz=16'" />
              <a href="${site.url}" target="_blank" class="text-blue-400 hover:underline break-words">${site.title}</a>
              <small class="text-gray-400 text-sm">${domain}</small>
            </h3>
            <p class="text-gray-300">${site.description}</p>
          `;
          resultsDiv.appendChild(item);
        });
      } else {
        const res = await fetch(`https://crawler30.onrender.com/images?query=${q}`);
        const urls = await res.json();

        resultsDiv.innerHTML = '<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>';
        const grid = resultsDiv.querySelector("div");
        urls.forEach(item => {
          const img = document.createElement("img");
          img.src = item.thumbnail || item.image;
          img.alt = item.title || "Image result";
          img.title = item.title || "";
          img.loading = "lazy";
          img.className = "w-full h-32 object-cover rounded-lg border border-gray-700 hover:scale-105 transition cursor-pointer";
          img.addEventListener("click", () => {
            document.cookie = `viewImage=${encodeURIComponent(item.image)}; path=/; max-age=86400`;
            window.location.href = "view.html";
          });
          grid.appendChild(img);
        });
      }
    }
  </script>
</body>
</html>
